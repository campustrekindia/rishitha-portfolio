<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;700;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-left: 2px solid black;
        }
        ::-webkit-scrollbar-thumb {
            background: #000;
            border: 2px solid #f1f1f1;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Utilities */
        .neobrutal-shadow {
            box-shadow: 8px 8px 0px 0px rgba(0,0,0,1);
        }
        .neobrutal-shadow-hover:hover {
            box-shadow: 4px 4px 0px 0px rgba(0,0,0,1);
            transform: translate(2px, 2px);
        }
        .neobrutal-shadow-active:active {
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,1);
            transform: translate(4px, 4px);
        }
        
        .dragging {
            box-shadow: 12px 12px 0px 0px rgba(0,0,0,1) !important;
            cursor: grabbing !important;
        }

        .window-appear {
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .bg-grid-pattern {
            background-image: radial-gradient(circle, #000 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-[#ff90e8] overflow-hidden h-screen w-screen transition-colors duration-500" id="main-body">

    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10 pointer-events-none bg-grid-pattern"></div>

    <!-- Desktop Icons Container -->
    <div class="absolute inset-0 p-8 flex flex-col flex-wrap content-start gap-8 z-0 pointer-events-none">
        <!-- Icons injected via JS -->
        <div id="desktop-icons" class="pointer-events-auto flex flex-col gap-6"></div>
    </div>

    <!-- Windows Container -->
    <div id="windows-container"></div>

    <!-- Chaos Button -->
    <div class="absolute bottom-20 right-8 z-0">
        <button id="chaos-btn" 
            class="w-16 h-16 rounded-full border-4 border-black font-black text-xs flex items-center justify-center text-center transform hover:rotate-12 transition-transform bg-white text-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] cursor-pointer z-0">
            PARTY
        </button>
    </div>

    <!-- Taskbar -->
    <div class="absolute bottom-0 left-0 right-0 h-12 bg-[#232323] border-t-4 border-black flex items-center px-2 justify-between z-50">
        <div class="flex items-center gap-2" id="taskbar-apps">
            <button onclick="resetSystem()" 
                class="bg-[#00e0ff] h-8 px-4 font-black border-2 border-black shadow-[2px_2px_0px_0px_white] active:shadow-none active:translate-y-1 text-sm flex items-center gap-2 mr-2">
                <i data-lucide="zap" class="w-4 h-4"></i> START
            </button>
            <div class="h-6 w-[2px] bg-gray-600 mx-1"></div>
            <!-- Taskbar Items injected via JS -->
        </div>
        
        <div id="clock" class="bg-black text-[#00e0ff] px-3 py-1 font-mono text-sm border-2 border-[#00e0ff] hidden sm:block">
            00:00
        </div>
    </div>

    <script>
        /**
         * STATE & CONFIG
         */
        let windows = [];
        let nextZIndex = 100;
        let chaosMode = false;
        let isDragging = false;
        
        const COLORS = {
            bg: '#ff90e8',
            chaos: '#000000',
            accent1: '#ffc900',
            accent2: '#00e0ff',
            accent3: '#ff5c5c',
        };

        const APPS = {
            welcome: { title: 'Welcome.txt', icon: 'terminal', w: 400, h: 320 },
            about: { title: 'Profile.exe', icon: 'user', w: 500, h: 600 },
            projects: { title: 'Work_Gallery', icon: 'folder-open', w: 700, h: 500 },
            skills: { title: 'Stats & Skills', icon: 'cpu', w: 400, h: 450 },
            paint: { title: 'MsPaint_Clone', icon: 'palette', w: 600, h: 500 },
            contact: { title: 'Comms_Link', icon: 'mail', w: 400, h: 450 }
        };

        /**
         * INITIALIZATION
         */
        document.addEventListener('DOMContentLoaded', () => {
            renderDesktopIcons();
            openWindow('welcome');
            startClock();
            
            // Chaos Button
            document.getElementById('chaos-btn').addEventListener('click', toggleChaosMode);

            lucide.createIcons();
        });

        /**
         * RENDER FUNCTIONS
         */
        function renderDesktopIcons() {
            const container = document.getElementById('desktop-icons');
            const icons = [
                { id: 'about', label: 'About Me', icon: 'user', color: 'bg-[#ffc900]' },
                { id: 'projects', label: 'Projects', icon: 'folder-open', color: 'bg-[#00e0ff]' },
                { id: 'skills', label: 'Skills', icon: 'cpu', color: 'bg-[#ff5c5c]' },
                { id: 'paint', label: 'Paint', icon: 'palette', color: 'bg-white' },
                { id: 'contact', label: 'Contact', icon: 'mail', color: 'bg-[#5cff87]' },
            ];

            container.innerHTML = icons.map(item => `
                <button onclick="openWindow('${item.id}')" class="group flex flex-col items-center gap-2 w-24 p-2 cursor-pointer focus:outline-none">
                    <div class="w-16 h-16 ${item.color} border-[3px] border-black flex items-center justify-center shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] group-hover:translate-x-[2px] group-hover:translate-y-[2px] group-hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-all duration-100">
                        <i data-lucide="${item.icon}" class="w-8 h-8 text-black" stroke-width="2.5"></i>
                    </div>
                    <span class="font-bold bg-black text-white px-2 py-0.5 text-xs shadow-[2px_2px_0px_0px_rgba(255,255,255,1)]">
                        ${item.label}
                    </span>
                </button>
            `).join('');
        }

        function renderTaskbar() {
            const container = document.getElementById('taskbar-apps');
            // Keep the start button and separator
            const staticContent = container.innerHTML.split('<div class="h-6 w-[2px] bg-gray-600 mx-1"></div>')[0] + '<div class="h-6 w-[2px] bg-gray-600 mx-1"></div>';
            
            const dynamicContent = windows.map(win => `
                <button onclick="focusWindow('${win.id}')" 
                    class="h-8 px-3 text-xs font-bold font-mono border-2 border-black truncate max-w-[150px] transition-colors ${win.zIndex === nextZIndex - 1 ? 'bg-white shadow-[2px_2px_0px_0px_rgba(255,255,255,0.5)]' : 'bg-gray-400 text-gray-800'}">
                    ${win.title}
                </button>
            `).join('');
            
            container.innerHTML = staticContent + dynamicContent;
        }

        /**
         * WINDOW MANAGEMENT
         */
        function openWindow(type) {
            const config = APPS[type];
            const id = type + '-' + Date.now(); // Unique ID for multiple instances if desired, though we usually singleton logic here
            
            // Check if singleton type already exists (optional, but good for this OS feel)
            const existing = windows.find(w => w.type === type);
            if (existing) {
                focusWindow(existing.id);
                return;
            }

            const winData = {
                id,
                type,
                title: config.title,
                x: 50 + (windows.length * 30) + (Math.random() * 20),
                y: 50 + (windows.length * 30) + (Math.random() * 20),
                width: config.w,
                height: config.h,
                zIndex: nextZIndex++
            };

            windows.push(winData);
            createWindowDOM(winData);
            renderTaskbar();
        }

        function closeWindow(id) {
            const winEl = document.getElementById(id);
            if (winEl) winEl.remove();
            windows = windows.filter(w => w.id !== id);
            renderTaskbar();
        }

        function focusWindow(id) {
            const win = windows.find(w => w.id === id);
            if (win) {
                win.zIndex = nextZIndex++;
                const el = document.getElementById(id);
                if (el) el.style.zIndex = win.zIndex;
                renderTaskbar();
            }
        }

        function createWindowDOM(win) {
            const container = document.getElementById('windows-container');
            const div = document.createElement('div');
            div.id = win.id;
            div.className = 'absolute flex flex-col border-[3px] border-black bg-white overflow-hidden window-appear neobrutal-shadow';
            div.style.left = `${win.x}px`;
            div.style.top = `${win.y}px`;
            div.style.width = `${win.width}px`;
            div.style.height = `${win.height}px`;
            div.style.zIndex = win.zIndex;
            div.style.maxHeight = '80vh';

            // Window Header
            div.innerHTML = `
                <div class="bg-[#232323] text-white px-2 py-1 flex justify-between items-center cursor-grab active:cursor-grabbing select-none window-header"
                     onmousedown="startDrag(event, '${win.id}')">
                    <div class="flex items-center gap-2 font-bold font-mono uppercase tracking-widest text-sm pointer-events-none">
                        <div class="w-3 h-3 bg-[#ff5c5c] rounded-full border border-white"></div>
                        ${win.title}
                    </div>
                    <div class="flex items-center gap-1">
                        <button class="p-1 hover:bg-gray-700 rounded"><i data-lucide="minus" size="14" class="w-3.5 h-3.5"></i></button>
                        <button class="p-1 hover:bg-gray-700 rounded"><i data-lucide="maximize-2" size="14" class="w-3.5 h-3.5"></i></button>
                        <button onclick="closeWindow('${win.id}')" class="p-1 hover:bg-[#ff5c5c] rounded transition-colors"><i data-lucide="x" size="14" class="w-3.5 h-3.5"></i></button>
                    </div>
                </div>
                <div class="flex-1 overflow-auto p-4 font-sans relative h-full">
                    ${getWindowContent(win.type, win.id)}
                </div>
            `;

            container.appendChild(div);
            
            // Re-init icons for the new window
            lucide.createIcons();

            // Special init for Paint
            if (win.type === 'paint') {
                initPaint(win.id);
            }
        }

        function getWindowContent(type, id) {
            switch(type) {
                case 'welcome':
                    return `
                        <div class="space-y-4">
                            <div class="bg-yellow-100 border-l-4 border-black p-4 font-mono text-sm">
                                System initialized. User detected.
                            </div>
                            <h1 class="text-4xl font-black">HELLO, WORLD.</h1>
                            <p class="text-lg font-medium">I'm a Creative Developer who builds things for the web. This is my digital playground.</p>
                            <div class="mt-8 grid grid-cols-2 gap-4">
                                <button onclick="openWindow('projects')" class="bg-[#00e0ff] border-2 border-black p-3 font-bold neobrutal-shadow-hover transition-all">SEE PROJECTS</button>
                                <button onclick="openWindow('contact')" class="bg-[#ff5c5c] border-2 border-black p-3 font-bold neobrutal-shadow-hover transition-all">HIRE ME</button>
                            </div>
                        </div>
                    `;
                case 'about':
                    return `
                        <div class="space-y-6">
                            <div class="flex gap-4 items-center">
                                <div class="w-24 h-24 bg-black overflow-hidden border-2 border-black shrink-0">
                                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Me" class="w-full h-full object-cover bg-white" />
                                </div>
                                <div>
                                    <h2 class="text-2xl font-black uppercase">The Developer</h2>
                                    <p class="font-mono text-sm text-gray-600">v2.0.25 (Latest Build)</p>
                                </div>
                            </div>
                            <p class="font-medium">I specialize in turning caffeine into code. I love React, UI/UX design, and making websites feel like video games.</p>
                            <div class="border-t-2 border-dashed border-black pt-4">
                                <h3 class="font-black mb-4">STATS</h3>
                                ${getSkillBar('REACT.JS', 90, 'bg-[#00e0ff]')}
                                ${getSkillBar('UI DESIGN', 85, 'bg-[#ff5c5c]')}
                                ${getSkillBar('BACKEND', 70, 'bg-[#ffc900]')}
                                ${getSkillBar('COFFEE', 99, 'bg-black text-white')}
                            </div>
                        </div>
                    `;
                case 'projects':
                    return `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-4">
                            ${getProjectCard('Neon E-Comm', ['React', 'Stripe'], 'High-contrast shopping experience.')}
                            ${getProjectCard('Task RPG', ['Vue', 'Firebase'], 'Gamified todo list with monsters.')}
                            ${getProjectCard('CryptoDash', ['D3.js', 'API'], 'Real-time financial visualization.')}
                            ${getProjectCard('This OS', ['Vanilla JS', 'Tailwind'], 'Meta. The site you are currently looking at.')}
                        </div>
                    `;
                case 'paint':
                    return `
                        <div class="flex flex-col gap-4 h-full" style="min-height: 350px;">
                            <div class="flex gap-2 p-2 border-b-2 border-black bg-gray-50">
                                <button class="color-btn w-8 h-8 rounded-full border-2 border-black bg-black" data-color="#000000"></button>
                                <button class="color-btn w-8 h-8 rounded-full border-2 border-black bg-[#ff5c5c]" data-color="#ff5c5c"></button>
                                <button class="color-btn w-8 h-8 rounded-full border-2 border-black bg-[#00e0ff]" data-color="#00e0ff"></button>
                                <button class="color-btn w-8 h-8 rounded-full border-2 border-black bg-[#ffc900]" data-color="#ffc900"></button>
                                <button onclick="clearCanvas('${id}')" class="ml-auto px-3 py-1 bg-red-500 text-white font-bold border-2 border-black shadow-[2px_2px_0px_0px_black] active:shadow-none active:translate-x-[2px] active:translate-y-[2px]">CLEAR</button>
                            </div>
                            <canvas id="canvas-${id}" class="w-full h-full flex-1 border-2 border-dashed border-gray-400 cursor-crosshair touch-none bg-white"></canvas>
                        </div>
                    `;
                case 'contact':
                    return `
                        <div class="h-full flex flex-col font-mono">
                            <div class="bg-black text-green-500 p-4 flex-1 overflow-y-auto mb-4 font-bold text-sm">
                                <p>> INITIATING UPLINK...</p>
                                <p>> CONNECTION ESTABLISHED.</p>
                                <p>> EMAIL: hello@dev-portfolio.com</p>
                                <br/>
                                <p class="animate-pulse">> AWAITING INPUT_</p>
                            </div>
                            <form class="space-y-3" onsubmit="event.preventDefault(); alert('Transmission Sent!');">
                                <input type="text" placeholder="SUBJECT" class="w-full border-2 border-black p-2 font-sans font-bold focus:bg-yellow-100 outline-none" />
                                <textarea placeholder="MESSAGE" rows="3" class="w-full border-2 border-black p-2 font-sans font-bold focus:bg-yellow-100 outline-none"></textarea>
                                <button class="w-full bg-[#00e0ff] border-2 border-black py-2 font-black shadow-[4px_4px_0px_0px_black] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-[2px_2px_0px_0px_black] transition-all">SEND TRANSMISSION</button>
                            </form>
                        </div>
                    `;
                default: return 'Content Error';
            }
        }

        // Helpers for HTML strings
        function getSkillBar(label, level, color) {
            return `
                <div class="mb-4">
                    <div class="flex justify-between mb-1 font-mono font-bold text-sm"><span>${label}</span><span>LVL ${level}</span></div>
                    <div class="h-6 w-full border-2 border-black p-[2px] bg-white">
                        <div class="h-full ${color} animate-pulse" style="width: ${level}%"></div>
                    </div>
                </div>
            `;
        }
        function getProjectCard(title, tech, desc) {
            const tags = tech.map(t => `<span class="px-1 py-0.5 bg-black text-white text-xs font-mono">${t}</span>`).join('');
            return `
                <div class="p-4 border-2 border-black bg-white shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:scale-[1.02] transition-transform">
                    <h3 class="font-black text-xl uppercase mb-2">${title}</h3>
                    <div class="flex gap-2 flex-wrap mb-3">${tags}</div>
                    <p class="font-medium leading-tight mb-4">${desc}</p>
                    <button class="w-full py-2 bg-white border-2 border-black font-bold hover:bg-black hover:text-white transition-colors">VIEW</button>
                </div>
            `;
        }

        /**
         * DRAG LOGIC
         */
        let activeDrag = null;
        let dragOffset = { x: 0, y: 0 };

        function startDrag(e, id) {
            focusWindow(id);
            const winEl = document.getElementById(id);
            activeDrag = winEl;
            
            // Calculate offset relative to window
            const rect = winEl.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;

            // Add styles
            winEl.classList.add('dragging');
            
            document.addEventListener('mousemove', onDrag);
            document.addEventListener('mouseup', stopDrag);
        }

        function onDrag(e) {
            if (!activeDrag) return;
            e.preventDefault(); // Prevent text selection
            
            let x = e.clientX - dragOffset.x;
            let y = e.clientY - dragOffset.y;

            // Bounds check (optional, but nice)
            // if (y < 0) y = 0;

            activeDrag.style.left = `${x}px`;
            activeDrag.style.top = `${y}px`;
        }

        function stopDrag() {
            if (activeDrag) {
                activeDrag.classList.remove('dragging');
                
                // Update internal state
                const winData = windows.find(w => w.id === activeDrag.id);
                if (winData) {
                    winData.x = parseInt(activeDrag.style.left);
                    winData.y = parseInt(activeDrag.style.top);
                }
                
                activeDrag = null;
            }
            document.removeEventListener('mousemove', onDrag);
            document.removeEventListener('mouseup', stopDrag);
        }

        /**
         * PAINT APP LOGIC
         */
        function initPaint(winId) {
            // Need a slight delay to ensure DOM is ready and size is calculated
            setTimeout(() => {
                const canvas = document.getElementById(`canvas-${winId}`);
                if (!canvas) return;

                // Set actual canvas size to match display size
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;

                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.lineCap = 'round';
                ctx.lineWidth = 4;

                let painting = false;
                let currentColor = '#000000';

                // Attach color pickers
                const colorBtns = document.querySelectorAll(`#${winId} .color-btn`);
                colorBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        currentColor = e.target.getAttribute('data-color');
                        // Visual feedback could go here
                    });
                });

                function startDraw(e) {
                    painting = true;
                    draw(e);
                }

                function endDraw() {
                    painting = false;
                    ctx.beginPath();
                }

                function draw(e) {
                    if (!painting) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;

                    ctx.lineWidth = 4;
                    ctx.lineCap = 'round';
                    ctx.strokeStyle = currentColor;

                    ctx.lineTo(x, y);
                    ctx.stroke();
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                }

                canvas.addEventListener('mousedown', startDraw);
                canvas.addEventListener('mouseup', endDraw);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseleave', endDraw);
            }, 100);
        }

        function clearCanvas(winId) {
            const canvas = document.getElementById(`canvas-${winId}`);
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        /**
         * UTILS
         */
        function startClock() {
            const update = () => {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };
            update();
            setInterval(update, 1000);
        }

        function toggleChaosMode() {
            chaosMode = !chaosMode;
            const body = document.getElementById('main-body');
            const btn = document.getElementById('chaos-btn');
            
            if (chaosMode) {
                body.classList.replace('bg-[#ff90e8]', 'bg-black');
                body.classList.add('animate-pulse');
                btn.innerText = 'PANIC';
                btn.classList.add('bg-red-500', 'text-white', 'animate-spin');
                btn.classList.remove('bg-white', 'text-black');
            } else {
                body.classList.replace('bg-black', 'bg-[#ff90e8]');
                body.classList.remove('animate-pulse');
                btn.innerText = 'PARTY';
                btn.classList.remove('bg-red-500', 'text-white', 'animate-spin');
                btn.classList.add('bg-white', 'text-black');
            }
        }

        function resetSystem() {
            document.getElementById('windows-container').innerHTML = '';
            windows = [];
            openWindow('welcome');
            if (chaosMode) toggleChaosMode();
        }

    </script>
</body>
</html>
